<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Jira Bookmark</title>

    <style>
	body{font-family:Arial,Helvetica,Sans-serif;padding:40px 0 0;}
	a{border:1px solid #ccc;color:#999;text-decoration:none;padding:5px 10px;}
    </style>

  </head>
  <body>

    <a href="javascript:(() => {let z = prompt('your branch', `git checkout -b ${$('#issuekey-val').text() || $('#key-val').text()}_${$('#summary-val').text().toLowerCase().replace(/[\s\:\-\+\*\'\&quot;\/\,\<\>\)\(\!\@\.\[\]]/g, '_')}`.replace(/(_)\1+/g, '_').replace(/_$/g, ''));console.log(z)})();" title="jira->branchname">jira->branchname</a>
    <p>drag it to your bookmarks bar, open jira ticket page, click.<p>

    <br />

    <a href="javascript:(() => {let ary = [], messagesSelector = '', divStyle = '', getParent = () => {},v=2;if(location.href.includes('pulls')) {ary = [...document.querySelectorAll('.js-issue-row')];messagesSelector = 'a';divStyle = `style=&quot;color:#444d56;margin: 5px -187px 5px -73px;background:#f6f8fa;font-weight:bold;padding: 5px 0 5px 73px;border-width: 1px 0;&quot;`;getParent = (item) => {return item.parentNode}}else if(location.href.includes('commits')) {ary = [...document.querySelectorAll('li.js-details-container')];messagesSelector = 'a.message';divStyle = `style=&quot;color:#444d56;margin: 5px -345px 5px -56px;background: #f6f8fa;font-weight: bold;padding: 5px 0 5px 56px;border-width: 1px 0;&quot;`;getParent = (item) => {return item.parentNode.parentNode}}else if(location.href.includes('pull/')) {ary = [...document.querySelectorAll('.commit-message')];messagesSelector = 'a.message';divStyle = `style=&quot;color:#444d56;margin: 5px -126px 5px -29px;background: #f6f8fa;font-weight: bold;padding: 5px 0 5px 32px;border-width: 1px 0;&quot;`;getParent = (item) => {return item.parentNode.parentNode}}else{alert(404)}ary.forEach((item) => {const issueItem = item.querySelector(messagesSelector);let html = issueItem.innerHTML;let issue = html.match(/\[([^\]]+)]/g);if(issue){html = `<div ${divStyle}>Open in JIRA: `;issue.forEach((issueItem) => {let href = issueItem.replace(/\[|\]/g, '').toUpperCase();html += `<a style='color:#0366d6;margin-right:10px;background-position:center right;background-repeat:no-repeat;background-image:linear-gradient(transparent,transparent),url(&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiI+IDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzM2YyIgZD0iTTEuNSA0LjUxOGg1Ljk4MlYxMC41SDEuNXoiLz4gPHBhdGggZmlsbD0iIzM2YyIgZD0iTTUuNzY1IDFIMTF2NS4zOUw5LjQyNyA3LjkzN2wtMS4zMS0xLjMxTDUuMzkzIDkuMzVsLTIuNjktMi42ODggMi44MS0yLjgwOEw0LjIgMi41NDR6Ii8+IDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik05Ljk5NSAyLjAwNGwuMDIyIDQuODg1TDguMiA1LjA3IDUuMzIgNy45NSA0LjA5IDYuNzIzbDIuODgyLTIuODgtMS44NS0xLjg1MnoiLz4gPC9zdmc+&quot;);padding-right:13px' href=&quot;https://kfzteile24.atlassian.net/browse/${href}&quot; target=&quot;_blank&quot;>[${href}]</a>`;});getParent(issueItem).innerHTML += `${html}</div>`;}});})();" title="git->jira">git->jira</a>

    <p>go to github pull requests, commits or pull request details, click.<p>

    <textarea style="width:100%;height:50vh;">
      (() => {
        let ary = [], messagesSelector = '', divStyle = '', getParent = () => {},v=2;
        if(location.href.includes('pulls')) {
            ary = [...document.querySelectorAll('.js-issue-row')];
            messagesSelector = 'a';
            divStyle = `style="color:#444d56;margin: 5px -187px 5px -73px;background:#f6f8fa;font-weight:bold;padding: 5px 0 5px 73px;border-width: 1px 0;"`;
            getParent = (item) => {return item.parentNode}
        }else if(location.href.includes('commits')) {
            ary = [...document.querySelectorAll('li.js-details-container')];
            messagesSelector = 'a.message';
            divStyle = `style="color:#444d56;margin: 5px -345px 5px -56px;background: #f6f8fa;font-weight: bold;padding: 5px 0 5px 56px;border-width: 1px 0;"`;
            getParent = (item) => {return item.parentNode.parentNode}
        }else if(location.href.includes('pull/')) {
            ary = [...document.querySelectorAll('.commit-message')];
            messagesSelector = 'a.message';
            divStyle = `style="color:#444d56;margin: 5px -126px 5px -29px;background: #f6f8fa;font-weight: bold;padding: 5px 0 5px 32px;border-width: 1px 0;"`;
            getParent = (item) => {return item.parentNode.parentNode}
        }else{
            alert(404)
            // pop up with links
        }
        // add pull page ==> commits and title

        ary.forEach((item) => {
            const issueItem = item.querySelector(messagesSelector);
            let html = issueItem.innerHTML;
            let issue = html.match(/\[([^\]]+)]/g);
            if(issue){
                html = `<div ${divStyle}>Open in JIRA: `;
                issue.forEach((issueItem) => {
                    let href = issueItem.replace(/\[|\]/g, '').toUpperCase();
                    html += `<a style='color:#0366d6;margin-right:10px;background-position:center right;background-repeat:no-repeat;background-image:linear-gradient(transparent,transparent),url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiI+IDxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzM2YyIgZD0iTTEuNSA0LjUxOGg1Ljk4MlYxMC41SDEuNXoiLz4gPHBhdGggZmlsbD0iIzM2YyIgZD0iTTUuNzY1IDFIMTF2NS4zOUw5LjQyNyA3LjkzN2wtMS4zMS0xLjMxTDUuMzkzIDkuMzVsLTIuNjktMi42ODggMi44MS0yLjgwOEw0LjIgMi41NDR6Ii8+IDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik05Ljk5NSAyLjAwNGwuMDIyIDQuODg1TDguMiA1LjA3IDUuMzIgNy45NSA0LjA5IDYuNzIzbDIuODgyLTIuODgtMS44NS0xLjg1MnoiLz4gPC9zdmc+");padding-right:13px' href="https://kfzteile24.atlassian.net/browse/${href}" target="_blank">[${href}]</a>`;
                });
                getParent(issueItem).innerHTML += `${html}</div>`;
            }
        });
      })();

    </textarea>

  </body>
</html>
